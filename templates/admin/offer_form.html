<!-- templates/admin/offer_form.html - Enhanced version -->
{% extends "base.html" %}

{% block title %}{% if offer %}Edit Offer{% else %}Add New Offer{% endif %} - Hotel Royal Orchid{% endblock %}

{% block content %}
<div class="bg-white shadow">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center py-6">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">
                    {% if offer %}Edit Offer: {{ offer.code }}{% else %}Add New Offer{% endif %}
                </h1>
                <p class="text-gray-600">{% if offer %}Update offer details{% else %}Create a new promotional offer{% endif %}</p>
            </div>
            <a href="{{ url_for('admin.manage_offers') }}" class="bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition duration-300">
                Back to Offers
            </a>
        </div>
    </div>
</div>

<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <form method="POST" action="{% if offer %}{{ url_for('admin.edit_offer', offer_id=offer.id) }}{% else %}{{ url_for('admin.add_offer') }}{% endif %}">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Basic Information -->
            <div class="lg:col-span-2 space-y-6">
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Basic Information</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Offer Code *</label>
                            <input type="text" name="code" value="{{ offer.code if offer }}" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-transparent" 
                                   placeholder="WELCOME20">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Offer Name *</label>
                            <input type="text" name="name" value="{{ offer.name if offer }}" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-transparent"
                                   placeholder="Welcome Offer">
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea name="description" rows="3"
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-transparent"
                                  placeholder="Describe the offer for customers...">{{ offer.description if offer }}</textarea>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Discount Type *</label>
                            <select name="discount_type" required 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-transparent">
                                <option value="">Select Type</option>
                                <option value="percentage" {% if offer and offer.discount_type == 'percentage' %}selected{% endif %}>Percentage</option>
                                <option value="fixed" {% if offer and offer.discount_type == 'fixed' %}selected{% endif %}>Fixed Amount</option>
                                <option value="stay_x_pay_y" {% if offer and offer.discount_type == 'stay_x_pay_y' %}selected{% endif %}>Stay X Pay Y</option>
                                <option value="free_night" {% if offer and offer.discount_type == 'free_night' %}selected{% endif %}>Free Night</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Discount Value *</label>
                            <input type="number" name="discount_value" step="0.01" value="{{ offer.discount_value if offer }}" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-transparent"
                                   placeholder="20 for 20% or 1000 for â‚¹1000">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                            <input type="number" name="priority" value="{{ offer.priority if offer else 1 }}" min="1" max="10"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-transparent">
                        </div>
                    </div>
                </div>

                <!-- Targeting Criteria -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Targeting Criteria</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">User Type</label>
                            <select name="target_user_type"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-transparent">
                                <option value="all" {% if not offer or offer.target_user_type == 'all' %}selected{% endif %}>All Users</option>
                                <option value="new_user" {% if offer and offer.target_user_type == 'new_user' %}selected{% endif %}>New Users Only</option>
                                <option value="returning_user" {% if offer and offer.target_user_type == 'returning_user' %}selected{% endif %}>Returning Users</option>
                                <option value="vip" {% if offer and offer.target_user_type == 'vip' %}selected{% endif %}>VIP Users (3+ bookings)</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Season Type</label>
                            <select name="season_type"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-transparent">
                                <option value="all" {% if not offer or offer.season_type == 'all' %}selected{% endif %}>All Seasons</option>
                                <option value="peak" {% if offer and offer.season_type == 'peak' %}selected{% endif %}>Peak Season Only</option>
                                <option value="off_peak" {% if offer and offer.season_type == 'off_peak' %}selected{% endif %}>Off-Peak Only</option>
                                <option value="festival" {% if offer and offer.season_type == 'festival' %}selected{% endif %}>Festival Season</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Day of Week</label>
                            <select name="day_of_week"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-transparent">
                                <option value="all" {% if not offer or offer.day_of_week == 'all' %}selected{% endif %}>All Days</option>
                                <option value="weekend" {% if offer and offer.day_of_week == 'weekend' %}selected{% endif %}>Weekends Only</option>
                                <option value="weekday" {% if offer and offer.day_of_week == 'weekday' %}selected{% endif %}>Weekdays Only</option>
                            </select>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Min Stay (Nights)</label>
                                <input type="number" name="min_stay_nights" value="{{ offer.min_stay_nights if offer else 1 }}" min="1"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Max Stay</label>
                                <input type="number" name="max_stay_nights" value="{{ offer.max_stay_nights if offer }}" min="1"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-transparent"
                                       placeholder="No limit">
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Min Advance (Days)</label>
                                <input type="number" name="advance_booking_days" value="{{ offer.advance_booking_days if offer else 0 }}" min="0"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Max Advance</label>
                                <input type="number" name="max_advance_booking_days" value="{{ offer.max_advance_booking_days if offer }}" min="1"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-transparent"
                                       placeholder="No limit">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Minimum Amount (â‚¹)</label>
                            <input type="number" name="min_amount" step="0.01" value="{{ offer.min_amount if offer else 0 }}" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-transparent"
                                   placeholder="0 for no minimum">
                        </div>
                    </div>
                </div>

                <!-- Room Targeting -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Room Targeting</h3>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Target Room Types</label>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                            {% for room_type in room_types %}
                            <div class="flex items-center">
                                <input type="checkbox" name="target_room_types" value="{{ room_type }}" id="type_{{ room_type }}"
                                       class="h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded"
                                       {% if target_rooms and room_type in target_rooms.room_types %}checked{% endif %}>
                                <label for="type_{{ room_type }}" class="ml-2 text-sm text-gray-700 capitalize">
                                    {{ room_type.replace('_', ' ') }}
                                </label>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Target Specific Rooms</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 max-h-48 overflow-y-auto">
                            {% for room in rooms %}
                            <div class="flex items-center">
                                <input type="checkbox" name="target_room_ids" value="{{ room.id }}" id="room_{{ room.id }}"
                                       class="h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded"
                                       {% if target_rooms and room.id in target_rooms.room_ids %}checked{% endif %}>
                                <label for="room_{{ room.id }}" class="ml-2 text-sm text-gray-700">
                                    {{ room.name }} ({{ room.room_type }})
                                </label>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar Settings -->
            <div class="space-y-6">
                <!-- Validity Settings -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Validity & Limits</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Valid From</label>
                            <input type="date" name="valid_from" value="{{ offer.valid_from.strftime('%Y-%m-%d') if offer and offer.valid_from else '' }}"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Valid Until *</label>
                            <input type="date" name="valid_until" value="{{ offer.valid_until.strftime('%Y-%m-%d') if offer }}" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Usage Limit</label>
                            <input type="number" name="usage_limit" value="{{ offer.usage_limit if offer }}"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-transparent"
                                   placeholder="Leave empty for unlimited">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Maximum Discount (â‚¹)</label>
                            <input type="number" name="max_discount" step="0.01" value="{{ offer.max_discount if offer }}"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-transparent"
                                   placeholder="Leave empty for no limit">
                        </div>
                    </div>
                </div>

                <!-- Status Settings -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Status & Behavior</h3>
                    
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="text-sm font-medium text-gray-700">Active Offer</label>
                                <p class="text-xs text-gray-500">Show this offer to users</p>
                            </div>
                            <input type="checkbox" name="is_active" 
                                   class="h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded"
                                   {% if not offer or offer.is_active %}checked{% endif %}>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="text-sm font-medium text-gray-700">Public Offer</label>
                                <p class="text-xs text-gray-500">Show in public listings</p>
                            </div>
                            <input type="checkbox" name="is_public"
                                   class="h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded"
                                   {% if not offer or offer.is_public %}checked{% endif %}>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="text-sm font-medium text-gray-700">Auto Apply</label>
                                <p class="text-xs text-gray-500">Automatically apply for eligible users</p>
                            </div>
                            <input type="checkbox" name="auto_apply"
                                   class="h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded"
                                   {% if offer and offer.auto_apply %}checked{% endif %}>
                        </div>
                    </div>
                </div>

                <!-- Terms & Conditions -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Terms & Conditions</h3>
                    <textarea name="terms_conditions" rows="6"
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-transparent"
                              placeholder="Enter terms and conditions for this offer...">{{ offer.terms_conditions if offer }}</textarea>
                </div>

                <!-- Submit Button -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex space-x-4">
                        <a href="{{ url_for('admin.manage_offers') }}" 
                           class="flex-1 bg-gray-600 text-white text-center py-4 rounded-lg hover:bg-gray-700 transition duration-300 font-semibold">
                            Cancel
                        </a>
                        <button type="submit" 
                                class="flex-1 bg-amber-600 text-white py-4 rounded-lg hover:bg-amber-700 transition duration-300 font-semibold">
                            {% if offer %}Update Offer{% else %}Create Offer{% endif %}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}